' To reference one unit
'USEUNIT CommonRoutines

'Opening XPS through Batch file
'Created: 04/04/2018
'Created by: Anantha Narayanan
'Reviewed: 
'Reviewed by:
sub OpenXPS
  Set shell = CreateObject("WScript.Shell")
  shell.CurrentDirectory = "C:\XPS_Batch"
  shell.Run "xps.bat"
  If Aliases.Sparcs_N4_Client.xpsLoginWindow.Exists then 
   Log.Checkpoint "XPS Opened successfully"
  Else
   Log.Error "Unable to open XPS"
  End If
End Sub

'Xps Login
'Created: 04/04/2018
'Created by: Anantha Narayanan
'Reviewed: 
'Reviewed by:
Sub xpsLogIn
  Dim wndASITHREED
  Set wndASITHREED = Aliases.Sparcs_N4_Client.xpsLoginWindow
  Call wndASITHREED.Click(163, 14)
  Call wndASITHREED.Keys("[Down]")
  Call wndASITHREED.Click(148, 97)
  Call wndASITHREED.Keys("[BS][BS][BS][BS][BS][BS]"+flowData.Item("XPS_Username")+"[Tab]"+flowData.Item("XPS_Password")+"[Enter]")
  aqUtils.Delay 2000
  If Aliases.Sparcs_N4_Client.xpsLoginWindow.Exists then 
   Log.Error "XPS Login Failed"
  Else
  Log.Checkpoint "XPS Login successful"
   Aliases.Sparcs_N4_Client.xpsMainWinodw2.Maximize
  End If
  
End Sub

'Loading playscript
'Created: 04/04/2018
'Created by: Anantha Narayanan
'Reviewed: 
'Reviewed by:
Sub xpsSelectPlayScript
  Dim sparcs_N4_Client,wndProToolsMainWndClass
  Set sparcs_N4_Client = Aliases.Sparcs_N4_Client
  Set wndProToolsMainWndClass = sparcs_N4_Client.xpsMainWinodw2
  Call wndProToolsMainWndClass.MainMenu.Click("File|Play Script...")
  If sparcs_N4_Client.xpsPlayScriptSelectWindow.Exists Then 
    Log.Checkpoint "Choose Play Script window is available"
    Call sparcs_N4_Client.xpsPlayScriptSelectWindow.OpenFile(flowData.Item("PlayScript"), "Text Files (*.txt)")
    If wndProToolsMainWndClass.MDIClient.PlayScriptWindow2.Exists Then 
      Log.Checkpoint "ScriptPlayer Window is available"
      Call Aliases.Sparcs_N4_Client.xpsMainWinodw2.MDIClient.PlayScriptWindow2.Click(270, 74)
    Else
      Log.Error "ScriptPlayer Window is not available"  
    End If
  Else
    Log.Error "Choose Play Script window is not available"
  End If
  
  
End Sub

'Closing playscript window
'Created: 04/04/2018
'Created by: Anantha Narayanan
'Reviewed: 
'Reviewed by:
Sub xpsPlayScriptWindowClose
  Aliases.Sparcs_N4_Client.xpsMainWinodw2.MDIClient.PlayScriptWindow2.Close
  If Aliases.Sparcs_N4_Client.xpsMainWinodw2.MDIClient.PlayScriptWindow2.Exists Then
    Log.Error "ScriptPlayer Window is not closed"
  Else
    Log.Checkpoint "ScriptPlayer Window is closed"
  End If
End Sub


'Closing XPS application
'Created: 04/04/2018
'Created by: Anantha Narayanan
'Reviewed: 
'Reviewed by:
Sub xpsCloseApplication
  Dim AppProcess
 ' Obtains the N4 process
 Set AppProcess = Sys.Process("Sparcs N4 Client")
 ' Closes the process
 AppProcess.Close
End Sub 

'Replacing String in playscript file
'Input parameters : Playscrpt file along with path,Key in Playscript, Value which need to replace the Kap in playscript
'Created: 12/04/2018
'Created by: Anantha Narayanan
'Reviewed: 
'Reviewed by:
Sub ReplaceStringInPlayScript(PlayScriptPath,Stringkey,Stringval) 
  Dim Contentintxtfile
  Set FSO = CreateObject("scripting.filesystemobject")
  Set file = fso.OpenTextFile (PlayScriptPath, 1)
  Contentintxtfile = file.ReadAll
  Arraykey = Split(Stringkey , "~")
  Arrayval = Split(Stringval , "~")
  Lengthkey = UBound(Arraykey)
  Lengthval = UBound(Arrayval)
  If Lengthkey = Lengthval Then 
    For i = LBound(Arraykey) to UBound(Arraykey)
      Contentintxtfile = Replace(Contentintxtfile,Arraykey(i),Arrayval(i))
    Next
  Else
  Log.Error "Key length and value length are not matching"    
  End If
  If FSO.FileExists("C:\Sparcs Script\Temp\Scr_playScript.txt") Then 
    FSO.DeleteFile("C:\Sparcs Script\Temp\Scr_playScript.txt")
  End If
  Set NewFile=FSO.CreateTextFile("C:\Sparcs Script\Temp\scr_TestXPS.txt",2,true)
  NewFile.WriteLine (Contentintxtfile)
End Sub

